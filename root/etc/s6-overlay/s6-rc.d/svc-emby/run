#!/usr/bin/with-contenv bash

# env settings
APP_DIR="/app/emby"
export LD_LIBRARY_PATH="${APP_DIR}"
export FONTCONFIG_PATH="${APP_DIR}"/etc/fonts
if [ -d "/lib/x86_64-linux-gnu" ]; then
    export LIBVA_DRIVERS_PATH=/usr/lib/x86_64-linux-gnu/dri:"${APP_DIR}"/dri
fi
export SSL_CERT_FILE="${APP_DIR}"/etc/ssl/certs/ca-certificates.crt

s6-notifyoncheck -d -n 60 -w 5000 -c "nc -z 127.0.0.1 8096" \
    s6-setuidgid abc /app/emby/EmbyServer \
    -programdata /config \
    -ffdetect /app/emby/ffdetect \
    -ffmpeg /app/emby/ffmpeg \
    -ffprobe /app/emby/ffprobe \
    -restartexitcode 3
